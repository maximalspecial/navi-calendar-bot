# Navi Calendar Bot

Цей скрипт синхронізує майбутні матчі NAVI зі сторінки [bo3.gg](https://bo3.gg/teams/natus-vincere/matches) з календарем Google.

## Як відбувається оновлення подій

1. **Парсинг сторінки**: `scrape_matches()` відкриває сторінку через Playwright, чекає поки з'являться рядки з матчами та збирає дані по кожній грі — назви команд, турнір, формат, дату й час. Дані приводяться до часового поясу `Europe/Kyiv` та відфільтровуються за горизонтом `LOOKAHEAD_DAYS` і допустимим «грейсом» у минуле `PAST_GRACE_MINUTES`.
2. **Пошук у календарі**: для кожного матчу `create_events()` викликає `find_existing_event()`, який шукає події з таким самим заголовком «Team A vs Team B» у діапазоні +/-7 днів від поточної дати. Найближча за часом подія вважається відповідною.
3. **Оновлення без дублікатів**: якщо знайдено збіг, але час або опис змінився, виконується `events().patch(...)`, який оновлює існуючий запис, а не створює новий. Якщо різниця в часі ≤ 5 хвилин і заголовок той самий, подія пропускається як актуальна.
4. **Створення нових записів**: коли відповідного запису немає, створюється нова подія з посиланням на матч у полі `description`.
5. **Звітність**: у фіналі виводиться кількість нових та оновлених подій (`[DONE] Created X events, updated Y events.`), що видно у логах запуску.

## Налаштування через змінні середовища

- `GOOGLE_CREDENTIALS_JSON` — обов'язково, JSON сервісного акаунта з правами на календар.
- `CALENDAR_ID` — ідентифікатор календаря (за замовчуванням `primary`).
- `LOOKAHEAD_DAYS` — горизонт у днях, на який завантажуються матчі (стандартно 60).
- `PAST_GRACE_MINUTES` — скільки хвилин минулих матчів усе ще вважаємо актуальними (стандартно 0).
- `TODAY_RECHECK_INTERVAL_SECONDS` — пауза між перепарсуванням, якщо є матчі на сьогодні (стандартно 3600 с = 1 година).

## Запуск

```bash
pip install -r requirements.txt
python bo3_calendar.py
```

Скрипт підійде для періодичних запусків (наприклад, через cron або GitHub Actions), адже він самостійно оновлює перенесені матчі й не створює дублікати. Якщо серед останнього парсингу є бодай один матч із датою «сьогодні», який ще не почався (або завершився не раніше, ніж дозволено `PAST_GRACE_MINUTES`), бот зробить паузу (за замовчуванням до години) і повторить синхронізацію, щоб підхопити зміни розкладу у день гри. Якщо до старту лишається менше години, затримка перед наступним запуском скоротиться до часу, що залишився до матчу.
